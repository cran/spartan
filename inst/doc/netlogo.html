<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />

<meta name="viewport" content="width=device-width, initial-scale=1">

<meta name="author" content="Kieran Alden" />

<meta name="date" content="2018-11-19" />

<title>Analysing Netlogo Simulations Using Netlogo</title>



<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>



<link href="data:text/css;charset=utf-8,body%20%7B%0Abackground%2Dcolor%3A%20%23fff%3B%0Amargin%3A%201em%20auto%3B%0Amax%2Dwidth%3A%20700px%3B%0Aoverflow%3A%20visible%3B%0Apadding%2Dleft%3A%202em%3B%0Apadding%2Dright%3A%202em%3B%0Afont%2Dfamily%3A%20%22Open%20Sans%22%2C%20%22Helvetica%20Neue%22%2C%20Helvetica%2C%20Arial%2C%20sans%2Dserif%3B%0Afont%2Dsize%3A%2014px%3B%0Aline%2Dheight%3A%201%2E35%3B%0A%7D%0A%23header%20%7B%0Atext%2Dalign%3A%20center%3B%0A%7D%0A%23TOC%20%7B%0Aclear%3A%20both%3B%0Amargin%3A%200%200%2010px%2010px%3B%0Apadding%3A%204px%3B%0Awidth%3A%20400px%3B%0Aborder%3A%201px%20solid%20%23CCCCCC%3B%0Aborder%2Dradius%3A%205px%3B%0Abackground%2Dcolor%3A%20%23f6f6f6%3B%0Afont%2Dsize%3A%2013px%3B%0Aline%2Dheight%3A%201%2E3%3B%0A%7D%0A%23TOC%20%2Etoctitle%20%7B%0Afont%2Dweight%3A%20bold%3B%0Afont%2Dsize%3A%2015px%3B%0Amargin%2Dleft%3A%205px%3B%0A%7D%0A%23TOC%20ul%20%7B%0Apadding%2Dleft%3A%2040px%3B%0Amargin%2Dleft%3A%20%2D1%2E5em%3B%0Amargin%2Dtop%3A%205px%3B%0Amargin%2Dbottom%3A%205px%3B%0A%7D%0A%23TOC%20ul%20ul%20%7B%0Amargin%2Dleft%3A%20%2D2em%3B%0A%7D%0A%23TOC%20li%20%7B%0Aline%2Dheight%3A%2016px%3B%0A%7D%0Atable%20%7B%0Amargin%3A%201em%20auto%3B%0Aborder%2Dwidth%3A%201px%3B%0Aborder%2Dcolor%3A%20%23DDDDDD%3B%0Aborder%2Dstyle%3A%20outset%3B%0Aborder%2Dcollapse%3A%20collapse%3B%0A%7D%0Atable%20th%20%7B%0Aborder%2Dwidth%3A%202px%3B%0Apadding%3A%205px%3B%0Aborder%2Dstyle%3A%20inset%3B%0A%7D%0Atable%20td%20%7B%0Aborder%2Dwidth%3A%201px%3B%0Aborder%2Dstyle%3A%20inset%3B%0Aline%2Dheight%3A%2018px%3B%0Apadding%3A%205px%205px%3B%0A%7D%0Atable%2C%20table%20th%2C%20table%20td%20%7B%0Aborder%2Dleft%2Dstyle%3A%20none%3B%0Aborder%2Dright%2Dstyle%3A%20none%3B%0A%7D%0Atable%20thead%2C%20table%20tr%2Eeven%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0Ap%20%7B%0Amargin%3A%200%2E5em%200%3B%0A%7D%0Ablockquote%20%7B%0Abackground%2Dcolor%3A%20%23f6f6f6%3B%0Apadding%3A%200%2E25em%200%2E75em%3B%0A%7D%0Ahr%20%7B%0Aborder%2Dstyle%3A%20solid%3B%0Aborder%3A%20none%3B%0Aborder%2Dtop%3A%201px%20solid%20%23777%3B%0Amargin%3A%2028px%200%3B%0A%7D%0Adl%20%7B%0Amargin%2Dleft%3A%200%3B%0A%7D%0Adl%20dd%20%7B%0Amargin%2Dbottom%3A%2013px%3B%0Amargin%2Dleft%3A%2013px%3B%0A%7D%0Adl%20dt%20%7B%0Afont%2Dweight%3A%20bold%3B%0A%7D%0Aul%20%7B%0Amargin%2Dtop%3A%200%3B%0A%7D%0Aul%20li%20%7B%0Alist%2Dstyle%3A%20circle%20outside%3B%0A%7D%0Aul%20ul%20%7B%0Amargin%2Dbottom%3A%200%3B%0A%7D%0Apre%2C%20code%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0Aborder%2Dradius%3A%203px%3B%0Acolor%3A%20%23333%3B%0Awhite%2Dspace%3A%20pre%2Dwrap%3B%20%0A%7D%0Apre%20%7B%0Aborder%2Dradius%3A%203px%3B%0Amargin%3A%205px%200px%2010px%200px%3B%0Apadding%3A%2010px%3B%0A%7D%0Apre%3Anot%28%5Bclass%5D%29%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0Acode%20%7B%0Afont%2Dfamily%3A%20Consolas%2C%20Monaco%2C%20%27Courier%20New%27%2C%20monospace%3B%0Afont%2Dsize%3A%2085%25%3B%0A%7D%0Ap%20%3E%20code%2C%20li%20%3E%20code%20%7B%0Apadding%3A%202px%200px%3B%0A%7D%0Adiv%2Efigure%20%7B%0Atext%2Dalign%3A%20center%3B%0A%7D%0Aimg%20%7B%0Abackground%2Dcolor%3A%20%23FFFFFF%3B%0Apadding%3A%202px%3B%0Aborder%3A%201px%20solid%20%23DDDDDD%3B%0Aborder%2Dradius%3A%203px%3B%0Aborder%3A%201px%20solid%20%23CCCCCC%3B%0Amargin%3A%200%205px%3B%0A%7D%0Ah1%20%7B%0Amargin%2Dtop%3A%200%3B%0Afont%2Dsize%3A%2035px%3B%0Aline%2Dheight%3A%2040px%3B%0A%7D%0Ah2%20%7B%0Aborder%2Dbottom%3A%204px%20solid%20%23f7f7f7%3B%0Apadding%2Dtop%3A%2010px%3B%0Apadding%2Dbottom%3A%202px%3B%0Afont%2Dsize%3A%20145%25%3B%0A%7D%0Ah3%20%7B%0Aborder%2Dbottom%3A%202px%20solid%20%23f7f7f7%3B%0Apadding%2Dtop%3A%2010px%3B%0Afont%2Dsize%3A%20120%25%3B%0A%7D%0Ah4%20%7B%0Aborder%2Dbottom%3A%201px%20solid%20%23f7f7f7%3B%0Amargin%2Dleft%3A%208px%3B%0Afont%2Dsize%3A%20105%25%3B%0A%7D%0Ah5%2C%20h6%20%7B%0Aborder%2Dbottom%3A%201px%20solid%20%23ccc%3B%0Afont%2Dsize%3A%20105%25%3B%0A%7D%0Aa%20%7B%0Acolor%3A%20%230033dd%3B%0Atext%2Ddecoration%3A%20none%3B%0A%7D%0Aa%3Ahover%20%7B%0Acolor%3A%20%236666ff%3B%20%7D%0Aa%3Avisited%20%7B%0Acolor%3A%20%23800080%3B%20%7D%0Aa%3Avisited%3Ahover%20%7B%0Acolor%3A%20%23BB00BB%3B%20%7D%0Aa%5Bhref%5E%3D%22http%3A%22%5D%20%7B%0Atext%2Ddecoration%3A%20underline%3B%20%7D%0Aa%5Bhref%5E%3D%22https%3A%22%5D%20%7B%0Atext%2Ddecoration%3A%20underline%3B%20%7D%0A%0Acode%20%3E%20span%2Ekw%20%7B%20color%3A%20%23555%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Edt%20%7B%20color%3A%20%23902000%3B%20%7D%20%0Acode%20%3E%20span%2Edv%20%7B%20color%3A%20%2340a070%3B%20%7D%20%0Acode%20%3E%20span%2Ebn%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Efl%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Ech%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Est%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Eco%20%7B%20color%3A%20%23888888%3B%20font%2Dstyle%3A%20italic%3B%20%7D%20%0Acode%20%3E%20span%2Eot%20%7B%20color%3A%20%23007020%3B%20%7D%20%0Acode%20%3E%20span%2Eal%20%7B%20color%3A%20%23ff0000%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Efu%20%7B%20color%3A%20%23900%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%20code%20%3E%20span%2Eer%20%7B%20color%3A%20%23a61717%3B%20background%2Dcolor%3A%20%23e3d2d2%3B%20%7D%20%0A" rel="stylesheet" type="text/css" />

</head>

<body>




<h1 class="title toc-ignore">Analysing Netlogo Simulations Using Netlogo</h1>
<h4 class="author"><em>Kieran Alden</em></h4>
<h4 class="date"><em>2018-11-19</em></h4>



<p>This vignette focuses on how spartan can provide parameter samples for and analyse Netlogo Simulations. Use of spartan to analyse such simulations was detailed in our paper “Easing”</p>
<p>To ensure our demonstration in this tutorial can be replicated, we will utilise a model that was available in the Model Library, albeit with a small number of modifications. The virus model (Wilensky, 1998) simulates how a virus is transmitted and perpetuated amongst a population, based on a number of factors. The model is fully described with the simulation, so we direct readers to study that detail prior to performing this tutorial. As an overview, there are four parameters: the number of people in the population (people), the ease at which the virus spreads (infectiousness), the probability a person recovers from the virus (chance-of-recover), and the duration (weeks) after which the person either recovers or dies (duration). This tutorial will aid researchers understand how a Netlogo model can be better understood using the parameter analysis techniques available within spartan. We recommend that you have read either the tutorials for Techniques 1-4 or through or PLoS Computational Biology paper (Spartan: A Comprehensive Tool for Understanding Uncertainty in Simulations of Biological Systems, Alden et al 2013) before commencing this tutorial.</p>
<p>The version of the model in the library has no defined end point, so our first change is to stop the simulation after 100 years. Secondly, judgements concerning each parameter are constructed by varying the value the parameter is assigned and determining the effect on simulation response. The current model states the percentage of people at the current timepoint who are infected and immune. As we want to examine performance across the simulation, we have added four output measures: counts of the number of people who have died through not recovering from the infection (death-thru-sickness), the number who died but were immune (death-but-immune), the number who died through old age and never caught the infection (death-old-age), and the number of people who died while infected but during the time period allowed for recovery (death-old-andsick). We then use spartan to determine how three of the four parameters above (we exclude people for the reasons this is linked to the output responses) impact simulation behaviour. Thirdly, for reasons that will become clearer later, we introduce a new global parameter, dummy, which has no role in the code, and thus no impact on the simulation, To ease the reproduction of results in this tutorial, we have made the modified version of the model available from the SPARTAN website (www.ycil.org.uk)</p>
<div id="scope" class="section level3">
<h3>Scope</h3>
<p>Do note that the idea of this tutorial is to demonstrate the application of the toolkit, and is not intended to act as a full introduction to using Sensitivity Analysis techniques in the analysis of simulation results. In addition, it is assumed the reader has already worked through the vignette for spartan techniques 1-4.</p>
</div>
<div id="prerequisites" class="section level3">
<h3>Prerequisites</h3>
<ul>
<li>The R statistical environment, version 2.13.1 or later.</li>
<li>The spartan R package, downloaded from the Comprehensive R Archive Network (CRAN) or from the project website.</li>
<li>The lhs, gplots, ggplot2, and XML R packages, available for download from CRAN.</li>
<li>The Netlogo Virus model, available for download from our website if you want to run the model yourself, or the sample data from our runs.</li>
<li>We used the Headless version of Netlogo to run the simulations for all the sets of parameters that were generated for all techniques in this tutorial. To aid the adoption of this approach, the scripts we used to do this are all available on our website (www.ycil.org.uk).</li>
</ul>
</div>
<div id="parameter-robustness-technique-2-in-spartan" class="section level2">
<h2>Parameter Robustness (Technique 2 in SPARTAN)</h2>
<p>The robustness of a Netlogo simulation to parameter alteration can be determined through the use of this approach. Following the method described by Read et al (2012), a set of parameters of interest are identified, and a range of potential values each parameter could lie within is assigned. The technique examines the sensitivity to a change in one parameter. Thus, the value of each is perturbed independently, with all other parameters remaining at their calibrated value. This technique works with the Netlogo BehaviourSpace feature. In that feature, you can specify a range to explore for each parameter, and Netlogo will construct an XML file from this information and run the experiments. The results are stored in a CSV table, which the researcher can then analyse. spartan works by producing this XML file without the need to be in Netlogo, and then once the researcher has performed runs based on the information in that file, spartan can analyse the resultant data. Note that this tutorial builds on the information in Technique 2 rather than replaces it, so it is recommended that you are aware of the detail in that tutorial.</p>
<div id="parameter-sampling" class="section level3">
<h3>Parameter Sampling</h3>
<p>Now we are going to declare the variables required by the package to produce the Netlogo experiment file. Firstly, the spartan and XML libraries are imported, the latter to aid production of the Netlogo file. The variables required for this analysis are then declared in capital letters. The line underneath, beginning with a #, is a description of that being declared. Set the FILEPATH variable correctly to match the folder where you would like the Netlogo experiment file to be output to.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(spartan)
<span class="co"># Directory where the sample file should be stored</span>
FILEPATH&lt;-<span class="st">&quot;/home/user/robustness/&quot;</span>
<span class="co"># Name to give the setup file. No need for file extension</span>
NETLOGO_SETUPFILE_NAME&lt;-<span class="st">&quot;nl_robustness_setup&quot;</span>
<span class="co"># Parameters in simulation. List all the parameters that Netlogo is</span>
<span class="co"># required to know,</span>
PARAMETERS&lt;-<span class="kw">c</span>(<span class="st">&quot;people&quot;</span>,<span class="st">&quot;infectiousness&quot;</span>,<span class="st">&quot;chance-recover&quot;</span>,<span class="st">&quot;duration&quot;</span>)
<span class="co"># Now values for each of the parameters above</span>
<span class="co"># For parameters not being analysed, simply list the value</span>
<span class="co"># For parameters being analysed, put the min, max and increment values</span>
<span class="co"># of the parameter in square brackets, in double quotes, e.g.</span>
<span class="co"># &quot;[0.1,0.5,0.1]&quot;</span>
PARAMVALS&lt;-<span class="kw">c</span>(<span class="dv">150</span>,<span class="st">&quot;[10,90,10]&quot;</span>,<span class="st">&quot;[10,90,10]&quot;</span>,<span class="st">&quot;[5,40,5]&quot;</span>)
<span class="co"># Name of the setup simulation function in Netlogo simulation</span>
<span class="co"># Usually setup</span>
NETLOGO_SETUP_FUNCTION&lt;-<span class="st">&quot;setup&quot;</span>
<span class="co"># Name of the function that starts the simulation. Usually go</span>
NETLOGO_RUN_FUNCTION&lt;-<span class="st">&quot;go&quot;</span>
<span class="co"># Simulation output measures</span>
MEASURES&lt;-<span class="kw">c</span>(<span class="st">&quot;death-thru-sickness&quot;</span>,<span class="st">&quot;death-but-immune&quot;</span>,
<span class="st">&quot;death-old-age&quot;</span>,<span class="st">&quot;death-old-and-sick&quot;</span>)
<span class="co"># Number of times Netlogo should repeat the experiment for each</span>
<span class="co"># parameter set</span>
EXPERIMENT_REPETITIONS&lt;-<span class="dv">1</span>
<span class="co"># Whether Netlogo should collect metrics at each timestep</span>
RUNMETRICS_EVERYSTEP&lt;-<span class="st">&quot;true&quot;</span></code></pre></div>
<p>To get the value sets for each parameter:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">oat_generate_netlogo_behaviour_space_XML</span>(FILEPATH, NETLOGO_SETUPFILE_NAME, PARAMETERS, 
                                         PARAMVALS, NETLOGO_SETUP_FUNCTION, NETLOGO_RUN_FUNCTION, 
                                         MEASURES, EXPERIMENT_REPETITIONS, RUNMETRICS_EVERYSTEP)</code></pre></div>
<p>This will produce one XML file, in the directory specified, containing a set-up for a Netlogo BehaviourSpace run. Run the experiment using Netlogo (we did this in the terminal in Linux using the headless version of Netlogo, code for this available on our website, but running this in Netlogo is fine too). This will in turn produce one CSV file, saved in the directory of your choosing when you run the experiment.</p>
</div>
<div id="analysing-the-simulation-data" class="section level3">
<h3>Analysing The Simulation Data</h3>
<p>This section shows an analysis using the example data from our lab website, but the steps are just as applicable if you ran the experiments yourself. Here, all the results, for all parameters and values, are in one file. The technique below processes this file, recovering the results for each parameter and value pair for the specified timepoint, extracting these into one CSV file. This CSV file can then be processed using the analysis methods detailed in Technique 2, reducing the need for specific Netlogo techniques.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Import the package</span>
<span class="kw">library</span>(spartan)
<span class="kw">library</span>(XML)
<span class="co"># Folder containing the Netlogo Behaviour Space table, AND where the</span>
<span class="co"># processed results will be written to</span>
FILEPATH&lt;-<span class="st">&quot;/home/user/robustness/&quot;</span>
<span class="co"># Name of the Netlogo Behaviour Space Table file</span>
NETLOGO_BEHAVIOURSPACEFILE&lt;-<span class="st">&quot;virus_oat.csv&quot;</span>
<span class="co"># Array of the parameters to be analysed, but ONLY those perturbed</span>
PARAMETERS&lt;-<span class="kw">c</span>(<span class="st">&quot;infectiousness&quot;</span>,<span class="st">&quot;chance-recover&quot;</span>,<span class="st">&quot;duration&quot;</span>)
<span class="co"># Value assigned to each parameter at calibration (the baseline value)</span>
BASELINE&lt;-<span class="kw">c</span>(<span class="dv">60</span>,<span class="dv">50</span>,<span class="dv">20</span>)
<span class="co"># The maximum value for each parameter</span>
PMAX&lt;-<span class="kw">c</span>(<span class="dv">90</span>,<span class="dv">90</span>,<span class="dv">40</span>)
<span class="co"># The minimum value explored for each parameter</span>
PMIN&lt;-<span class="kw">c</span>(<span class="dv">10</span>,<span class="dv">10</span>,<span class="dv">5</span>)
<span class="co"># Amount the parameter value was incremened during sampling</span>
PINC&lt;-<span class="kw">c</span>(<span class="dv">10</span>,<span class="dv">10</span>,<span class="dv">5</span>)
<span class="co"># Timestep of interest. The behaviour space table is likely to contain</span>
<span class="co"># all timesteps - this narrows the analysis</span>
TIMESTEP&lt;-<span class="dv">5200</span>
<span class="co"># The simulation output measures being examined. Should be specified</span>
<span class="co"># as they are in the Netlogo file</span>
MEASURES&lt;-<span class="kw">c</span>(<span class="st">&quot;death-thru-sickness&quot;</span>,<span class="st">&quot;death-but-immune&quot;</span>,<span class="st">&quot;death-old-age&quot;</span>,
<span class="st">&quot;death-old-and-sick&quot;</span>)
<span class="co"># For each parameter value being analysed, a file is created</span>
<span class="co"># containing the median of each output measure, of each simulation run</span>
<span class="co"># for that value. This sets the name of this file. </span>
RESULTFILENAME&lt;-<span class="st">&quot;ParamValResponses.csv&quot;</span>
<span class="co"># The results of the A-Test comparisons of each parameter value</span>
<span class="co"># against that of the parameters baseline value are output as a file.</span>
<span class="co"># This sets the name of this file. </span>
ATESTRESULTSFILENAME&lt;-<span class="st">&quot;VirusOAT_ATests.csv&quot;</span>
<span class="co"># A-Test result value either side of 0.5 at which the difference</span>
<span class="co"># between two sets of results is significant</span>
ATESTSIGLEVEL&lt;-<span class="fl">0.21</span>
<span class="co"># What each measure represents. Used in graphing results</span>
MEASURE_SCALE&lt;-<span class="kw">c</span>(<span class="st">&quot;Number of People&quot;</span>,<span class="st">&quot;Number of People&quot;</span>,
<span class="st">&quot;Number of People&quot;</span>,<span class="st">&quot;Number of People&quot;</span>)
<span class="co"># Not used in this case, but when a simulation is analysed at multiple</span>
<span class="co"># timepoints (see tutorials 1-4)</span>
TIMEPOINTS&lt;-<span class="ot">NULL</span>; TIMEPOINTSCALE&lt;-<span class="ot">NULL</span>

<span class="kw">oat_process_netlogo_result</span>(FILEPATH,NETLOGO_BEHAVIOURSPACEFILE, PARAMETERS, 
                           BASELINE, PMIN, PMAX, PINC, MEASURES, RESULTFILENAME, 
                           ATESTRESULTSFILENAME, TIMESTEP)

<span class="co"># Note that PARAMVALS is set to NULL - we don't use that for Netlogo</span>
<span class="kw">oat_graphATestsForSampleSize</span>(FILEPATH, PARAMETERS, MEASURES, ATESTSIGLEVEL, 
                             ATESTRESULTSFILENAME, BASELINE, PMIN, PMAX, PINC, <span class="ot">NULL</span>, 
                             TIMEPOINTS, TIMEPOINTSCALE)</code></pre></div>
</div>
</div>
<div id="latin-hypercube-sampling-and-analysis-technique-3-in-spartan" class="section level2">
<h2>Latin-Hypercube Sampling and Analysis (Technique 3 in SPARTAN)</h2>
<p>Though Technique 2 of this toolkit elucidates the effects of perturbations of one parameter, it cannot show any non-linear effects which occur when two or more are adjusted simultaneously. This can be achieved using Technique 3, a Global Sensitivity Analysis technique. A number of parameter value sets are created through a latin-hypercube sampling approach, which selects values for each parameter from the parameter space, while aiming to reduce any possible correlations when the sample is produced. spartan then constructs a Netlogo experiment file for each parameter value set. The researcher then runs these in Netlogo. With there being a number of experiment files constructed with this technique, we would recommend that the reader uses a scripting language to perform these experiments, using the headless version of Netlogo. The script we have used to do this can be found on our lab website as an example. Once the runs are complete, spartan then analyses the resultant data, revealing any correlations between parameter and value, and thus indicating the paramters of greatest influence on the simulation.</p>
<div id="parameter-sampling-1" class="section level3">
<h3>Parameter Sampling</h3>
<p>Parameter samples for Netlogo simulations can be generated using the code below, detailed fully in the vignette for Technique 2. The last variable, ALGORITHM, controls whether a fully optimised latin-hypercube algorithm is used, or parameter values chosen from each section of the hypercube randomly. Both these algorithms are taken from the lhs package. Note that although an optimised sample may be preferable, the generation of parameter values using an optimal algorithm may take a long time (in our experience, over 24 hours for just 7 parameters). The ALGORITHM variable can be set to either ”normal” or ”optimal”</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(spartan)
<span class="co"># Directory where the samples should be stored</span>
FILEPATH&lt;-<span class="st">&quot;/home/user/LHC/&quot;</span>
<span class="co"># Parameters in simulation. List all the parameters that Netlogo is</span>
<span class="co"># required to know,</span>
PARAMETERS&lt;-<span class="kw">c</span>(<span class="st">&quot;people&quot;</span>,<span class="st">&quot;infectiousness&quot;</span>,<span class="st">&quot;chance-recover&quot;</span>,<span class="st">&quot;duration&quot;</span>)
<span class="co"># Now values for each of the parameters above</span>
<span class="co"># For parameters not being analysed, simply list the value</span>
<span class="co"># For parameters being analysed, put the min and max values of the</span>
<span class="co"># parameter in square brackets, in double quotes, e.g. &quot;[0.1,0.5]&quot;</span>
<span class="co"># Encapsulate strings, i.e.: &quot;\&quot;/home/user/Experiment/\&quot;&quot;</span>
PARAMVALS&lt;-<span class="kw">c</span>(<span class="dv">150</span>,<span class="st">&quot;[10,90]&quot;</span>,<span class="st">&quot;[10,90]&quot;</span>,<span class="st">&quot;[5,40]&quot;</span>)
<span class="co"># Number of parameter samples to take from hypercube</span>
NUMSAMPLES&lt;-<span class="dv">500</span>
<span class="co"># Name of function that sets up Netlogo simulation. Usually setup</span>
NETLOGO_SETUP_FUNCTION&lt;-<span class="st">&quot;setup&quot;</span>
<span class="co"># Name of function that starts Netlogo simulation. Usually go</span>
NETLOGO_RUN_FUNCTION&lt;-<span class="st">&quot;go&quot;</span>
<span class="co"># Simulation output measures</span>
MEASURES&lt;-<span class="kw">c</span>(<span class="st">&quot;death-thru-sickness&quot;</span>,<span class="st">&quot;death-but-immune&quot;</span>,<span class="st">&quot;death-old-age&quot;</span>,
<span class="st">&quot;death-old-and-sick&quot;</span>)
<span class="co"># Number of times the Netlogo experiment is repeated for each parameter</span>
<span class="co"># set</span>
EXPERIMENT_REPETITIONS&lt;-<span class="dv">1</span>
<span class="co"># Whether Netlogo metrics should be collected at each timestep</span>
RUNMETRICS_EVERYSTEP&lt;-<span class="st">&quot;true&quot;</span>
<span class="co"># Algorithm to use to generate the hypercube (normal or optimal)</span>
ALGORITHM&lt;-<span class="st">&quot;normal&quot;</span>

<span class="kw">lhc_generate_lhc_sample_netlogo</span>(FILEPATH,PARAMETERS,PARAMVALS,NUMSAMPLES,ALGORITHM,
                              EXPERIMENT_REPETITIONS,RUNMETRICS_EVERYSTEP,NETLOGO_SETUP_FUNCTION,
                              NETLOGO_RUN_FUNCTION,MEASURES)</code></pre></div>
</div>
<div id="analysing-the-results" class="section level3">
<h3>Analysing the Results</h3>
<p>Again the example shown here is for the example data from our lab website. Note for space reasons that the Netlogo parameter files themselves are not included in the download. This method iterates through all the Netlogo results for all parameter sets and collapses these into one CSV file, which can then be analysed using the techniques detailed in Technique 3.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Import the package</span>
<span class="kw">library</span>(spartan)
<span class="co"># Folder containing the Netlogo Behaviour Space table,</span>
<span class="co"># and where the processed results will be written to</span>
FILEPATH&lt;-<span class="st">&quot;/home/user/LHC/&quot;</span>
<span class="co"># Name of the result file (csv) generated by Netlogo, with no file</span>
<span class="co"># extension</span>
LHCSAMPLE_RESULTFILENAME&lt;-<span class="st">&quot;lhcResult&quot;</span>
<span class="co"># Location of a file containing the parameter value sets</span>
<span class="co"># generated by the hypercube sampling (i.e. the file generated</span>
<span class="co"># in the previous method of this tutorial. U</span>
SPARTAN_PARAMETER_FILE&lt;-<span class="st">&quot;LHC_Parameters_for_Runs.csv&quot;</span>
<span class="co"># Number of parameter samples generated from the hypercube</span>
NUMSAMPLES&lt;-<span class="dv">500</span>
<span class="co"># The simulation output measures being examined. Should be specified</span>
<span class="co"># as they are in the Netlogo file</span>
MEASURES&lt;-<span class="kw">c</span>(<span class="st">&quot;death-thru-sickness&quot;</span>,<span class="st">&quot;death-but-immune&quot;</span>,<span class="st">&quot;death-old-age&quot;</span>,
<span class="st">&quot;death-old-and-sick&quot;</span>)
<span class="co"># File name to give to the summary file that is produced showing</span>
<span class="co"># the parameter value sets alongside the median results for each</span>
<span class="co"># simulation output measure. </span>
LHC_ALL_SIM_RESULTS_FILE&lt;-<span class="st">&quot;Virus_LHCSummary.csv&quot;</span>
<span class="co"># Timestep of interest. The behaviour space table is likely to contain</span>
<span class="co"># all timesteps - this narrows the analysis</span>
TIMESTEP&lt;-<span class="dv">5200</span>
<span class="co"># Parameters of interest in this analysis</span>
PARAMETERS&lt;-<span class="kw">c</span>(<span class="st">&quot;infectiousness&quot;</span>,<span class="st">&quot;chance-recover&quot;</span>,<span class="st">&quot;duration&quot;</span>)
<span class="co"># What each measure represents. Used in graphing results</span>
MEASURE_SCALE&lt;-<span class="kw">c</span>(<span class="st">&quot;Number of People&quot;</span>,<span class="st">&quot;Number of People&quot;</span>,
<span class="st">&quot;Number of People&quot;</span>,<span class="st">&quot;Number of People&quot;</span>)
<span class="co"># File name to give to the file showing the Partial Rank Correlation</span>
<span class="co"># Coefficients for each parameter. Again note no file extension</span>
CORCOEFFSOUTPUTFILE&lt;-<span class="st">&quot;EgSet_corCoeffs&quot;</span>
<span class="co"># Not used in this case, but when a simulation is analysed at</span>
<span class="co"># multiple timepoints (see Tutorials 1-4)</span>
TIMEPOINTS&lt;-<span class="ot">NULL</span>; TIMEPOINTSCALE&lt;-<span class="ot">NULL</span>

<span class="kw">lhc_process_netlogo_result</span>(FILEPATH, LHCSAMPLE_RESULTFILENAME, SPARTAN_PARAMETER_FILE, NUMSAMPLES, MEASURES, LHC_ALL_SIM_RESULTS_FILE, TIMESTEP)

<span class="kw">lhc_generatePRCoEffs</span>(FILEPATH, PARAMETERS, MEASURES, LHC_ALL_SIM_RESULTS_FILE, CORCOEFFSOUTPUTFILE)

<span class="kw">lhc_graphMeasuresForParameterChange</span>(FILEPATH, PARAMETERS, MEASURES, MEASURE_SCALE, CORCOEFFSOUTPUTFILE, LHC_ALL_SIM_RESULTS_FILE)</code></pre></div>
</div>
</div>
<div id="technique-4-efast-sampling-and-analysis-technique-4" class="section level2">
<h2>Technique 4: eFAST Sampling and Analysis (Technique 4)</h2>
<p>This technique analyses simulation results generated through parametering using the eFAST approach (extended Fourier Amplitude Sampling Test). This perturbs the value of all parameters at the same time, with the aim of partitioning the variance in simulation output between input parameters. Values for each parameter are chosen using fourier frequency curves through a parameters potential range of values. A selected number of values are selected from points along the curve. Though all parameters are perturbed simultaneously, the method does focus on one parameter of interest in turn, by giving this a very different sampling frequency to that assigned to the other parameters. Thus for each parameter of interest in turn, a sampling frequency is assigned to each parameter and values chosen at points along the curve. So a set of simulation parameters then exists for each parameter of interest. As this is the case, this method can be computationally expensive, especially if a large number of samples is taken on the parameter search curve, or there are a large number of parameters. On top of this, to ensure adequate sampling each curve is also resampled with a small adjustment to the frequency, creating more parameter sets on which the simulation should be run. This attempts to limit any correlations and limit the effect of repeated parameter value sets being chosen. Thus, for a system where 8 parameters are being analysed, and 3 different sample curves used, 24 different sets of parameter value sets will be produced. Each of these 24 sets then contains the parameter values chosen from the frequency curves. This number of samples should be no lower than 65 (see the Marino paper for an explanation of how to select sample size). Once the sampling has been performed, simulation runs should be performed for each set generated. The eFAST algorithm then examines the simulation results for each parameter value set and, taking into account the sampling frequency used to produce those parameter values, partitions the variance in output between the input parameters.</p>
<p>SPARTAN has the ability to sample the space using the technique, produce Netlogo experiment files for these samples, through which the simulations can be run, and then analyse the resultant simulations.</p>
<div id="parameter-sampling-2" class="section level3">
<h3>Parameter Sampling</h3>
<p>The method below constructs parameter sets using the eFAST approach, detailed fully in the vignette for Technique 4. Note here the additional parameter: Dummy. Statistical inference in eFAST is generated though comparing the variance of each parameter to that of a parameter known to have no influence on the simulation. The dummy parameter sample fulfils this role.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(spartan)
<span class="co"># The directory where the samples should be stored</span>
FILEPATH&lt;-<span class="st">&quot;/home/user/eFAST/&quot;</span>
<span class="co"># Parameters for this simulation. List ALL the parameters that Netlogo needs to know, even those not being perturbed. Make # sure you include the dummy</span>
PARAMETERS&lt;-<span class="kw">c</span>(<span class="st">&quot;people&quot;</span>,<span class="st">&quot;infectiousness&quot;</span>,<span class="st">&quot;chance-recover&quot;</span>,<span class="st">&quot;duration&quot;</span>, <span class="st">&quot;dummy&quot;</span>)
<span class="co"># Now values for each of the parameters above. For parameters not being analysed, simply list the value</span>
<span class="co"># For parameters being analysed, put the min and max values of the parameter in square brackets, in double quotes, e.g. </span>
<span class="co"># &quot;[0.1,0.5]&quot; Encapsulate strings, i.e.: &quot;\&quot;/home/user/Experiment/\&quot;&quot;</span>
PARAMVALS&lt;-<span class="kw">c</span>(<span class="dv">150</span>,<span class="st">&quot;[10,90]&quot;</span>,<span class="st">&quot;[10,90]&quot;</span>,<span class="st">&quot;[5,40]&quot;</span>,<span class="st">&quot;[1,10]&quot;</span>)
<span class="co"># Number of resampling curves to use</span>
NUMCURVES&lt;-<span class="dv">3</span>
<span class="co"># Number of value samples to take from each parameter curve</span>
NUMSAMPLES&lt;-<span class="dv">65</span>
<span class="co"># The name of the function in Netlogo that sets up the simulation (Usually setup)</span>
NETLOGO_SETUP_FUNCTION&lt;-<span class="st">&quot;setup&quot;</span>
<span class="co"># Name of the function in Netlogo that starts the simulation (Usually go)</span>
NETLOGO_RUN_FUNCTION&lt;-<span class="st">&quot;go&quot;</span>
MEASURES&lt;-<span class="kw">c</span>(<span class="st">&quot;death-thru-sickness&quot;</span>,<span class="st">&quot;death-but-immune&quot;</span>,<span class="st">&quot;death-old-age&quot;</span>,<span class="st">&quot;death-old-and-sick&quot;</span>)
<span class="co"># Number of times the Netlogo run should be repeated for each parameter set</span>
EXPERIMENT_REPETITIONS&lt;-<span class="dv">1</span>
<span class="co"># Whether Netlogo should collect metrics at all timesteps</span>
RUNMETRICS_EVERYSTEP&lt;-<span class="st">&quot;true&quot;</span>

<span class="kw">efast_generate_sample_netlogo</span>(FILEPATH,NUMCURVES,NUMSAMPLES,MEASURES,PARAMETERS,PARAMVALS,EXPERIMENT_REPETITIONS,
                              RUNMETRICS_EVERYSTEP,NETLOGO_SETUP_FUNCTION,NETLOGO_RUN_FUNCTION)</code></pre></div>
</div>
<div id="analysing-simulation-data" class="section level3">
<h3>Analysing Simulation Data</h3>
<p>The below example analyses the Netlogo virus model results obtained for an eFAST sample, available from the project website. The objective is to get the Netlogo results into one file, one that is then compatible with the analysis methods detailed in the vignette for Technique 4.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(spartan)
<span class="co"># The directory where the netlogo experiment file should be stored</span>
FILEPATH&lt;-<span class="st">&quot;/home/kieran/Documents/Tutorial/eFAST/&quot;</span>
<span class="co"># Name of the result file generated by Netlogo. The sample number and</span>
<span class="co"># .csv are added to this</span>
EFASTSAMPLE_RESULTFILENAME&lt;-<span class="st">&quot;efast_result_set&quot;</span>
<span class="co"># The parameters being examined in this analysis. Include the dummy</span>
PARAMETERS&lt;-<span class="kw">c</span>(<span class="st">&quot;infectiousness&quot;</span>,<span class="st">&quot;chance-recover&quot;</span>,<span class="st">&quot;duration&quot;</span>,<span class="st">&quot;dummy&quot;</span>)
<span class="co"># Number of resampling curves to use</span>
NUMCURVES&lt;-<span class="dv">3</span>
<span class="co"># Number of value samples to take from each curve</span>
NUMSAMPLES&lt;-<span class="dv">65</span>
<span class="co"># The output measures by which you are analysing the results.</span>
MEASURES&lt;-<span class="kw">c</span>(<span class="st">&quot;death-thru-sickness&quot;</span>,<span class="st">&quot;death-but-immune&quot;</span>,<span class="st">&quot;death-old-age&quot;</span>,<span class="st">&quot;death-old-and-sick&quot;</span>)
<span class="co"># File created containing the median of each output measure, of each</span>
<span class="co"># simulation for this parameter set. Note no file extension</span>
RESULTFILENAME&lt;-<span class="st">&quot;ParamValResponses&quot;</span>
<span class="co"># Timestep of interest. The behaviour space table is likely to contain</span>
<span class="co"># all timesteps. This narrows the analysis</span>
TIMESTEP&lt;-<span class="dv">5200</span>
<span class="co"># Output measures to t-test to gain statistical significance</span>
OUTPUTMEASURES_TO_TTEST&lt;-<span class="dv">1</span><span class="op">:</span><span class="dv">4</span>
<span class="co"># T-Test confidence interval</span>
TTEST_CONF_INT&lt;-<span class="fl">0.95</span>
<span class="co"># Boolean noting whether graphs should be produced</span>
GRAPH_FLAG&lt;-<span class="ot">TRUE</span>
<span class="co"># Name of the final result file summarising the analysis, showing the</span>
<span class="co"># partitioning of the variance between parameters. Note no file</span>
<span class="co"># extension</span>
EFASTRESULTFILENAME&lt;-<span class="st">&quot;Virus_eFAST_Analysis&quot;</span>
<span class="co"># Not used in this case, but when a simulation is analysed at</span>
<span class="co"># multiple timepoints (see Tutorials 1-4)</span>
TIMEPOINTS&lt;-<span class="ot">NULL</span>; TIMEPOINTSCALE&lt;-<span class="ot">NULL</span>

<span class="kw">efast_process_netlogo_result</span>(FILEPATH, EFASTSAMPLE_RESULTFILENAME, PARAMETERS, NUMCURVES,
           NUMSAMPLES, MEASURES, RESULTFILENAME, TIMESTEP)

<span class="co"># Get all the results for each curve into one summary file for each curve</span>
<span class="kw">efast_get_overall_medians</span>(FILEPATH, NUMCURVES, PARAMETERS, NUMSAMPLES, MEASURES)

<span class="co"># Run the eFAST analysis</span>
<span class="kw">efast_run_Analysis</span>(FILEPATH, MEASURES, PARAMETERS, NUMCURVES, NUMSAMPLES, OUTPUTMEASURES_TO_TTEST, TTEST_CONF_INT, 
            GRAPH_FLAG, EFASTRESULTFILENAME, TIMEPOINTS, TIMEPOINTSCALE)</code></pre></div>
</div>
</div>



<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
